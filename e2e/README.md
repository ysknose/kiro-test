# E2E テスト

このディレクトリには、会社備品管理システムのエンドツーエンド（E2E）テストが含まれています。

## テストファイル

- `equipment-flow.spec.ts`: 備品登録から検索、貸出、返却までの完全なフローをテスト
- `error-cases.spec.ts`: バリデーションエラー、在庫切れ、権限エラーなどのエラーケースをテスト
- `test-utils.ts`: テスト用のユーティリティ関数

## 前提条件

1. JSON Server が起動していること（`bun run json-server`）
2. Next.js 開発サーバーが起動可能であること

## テストの実行方法

### すべての E2E テストを実行

```bash
bun run test:e2e
```

### UI モードでテストを実行（デバッグに便利）

```bash
bun run test:e2e:ui
```

### 特定のテストファイルのみ実行

```bash
bunx playwright test e2e/equipment-flow.spec.ts
```

### ヘッドレスモードを無効にして実行（ブラウザを表示）

```bash
bunx playwright test --headed
```

### テストレポートを表示

```bash
bun run test:e2e:report
```

## テストの構成

### equipment-flow.spec.ts

以下のシナリオをテストします：

1. **完全なフロー**: 備品登録 → 検索 → カテゴリフィルタリング → 詳細表示 → 貸出 → マイページ確認 → 返却
2. **複数回の貸出と返却**: 同じ備品を複数回借りて返却する
3. **貸出履歴の確認**: 貸出履歴ページで記録を確認

### error-cases.spec.ts

以下のエラーケースをテストします：

1. **バリデーションエラー**:

   - 必須フィールドの欠落
   - 備品名の文字数制限（100 文字）
   - カテゴリの文字数制限（50 文字）
   - 説明の文字数制限（500 文字）
   - 未来の購入日
   - 数量の範囲（0 以上）
   - 耐用年数の範囲（1 年以上）

2. **ビジネスロジックエラー**:

   - 在庫切れ備品の貸出
   - 借りていない備品の返却

3. **その他のエラー**:
   - 空の検索結果
   - 存在しない備品 ID でのアクセス

## テストデータ

- テストは独立して実行されるように設計されています
- 各テストは一意の備品名（タイムスタンプ付き）を使用します
- テスト用のユーザー ID: `user-1`（テストユーザー 1）

## 注意事項

- E2E テストは実際のアプリケーションを起動して実行されます
- Playwright 設定により、テスト実行時に自動的に開発サーバーが起動します
- テストは Chromium ブラウザで実行されます
- CI 環境では自動的にリトライが有効になります

## トラブルシューティング

### テストがタイムアウトする場合

- JSON Server が起動しているか確認してください
- ポート 3000 と 3001 が使用可能か確認してください
- `playwright.config.ts`のタイムアウト設定を調整してください

### テストが失敗する場合

- `playwright-report`ディレクトリのレポートを確認してください
- `--headed`オプションでブラウザを表示して実行してください
- スクリーンショットとトレースが自動的に保存されます
